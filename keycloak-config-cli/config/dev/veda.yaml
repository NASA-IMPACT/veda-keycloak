---
enabled: true
realm: veda
displayName: Applications
displayNameHtml: VEDA Ecosystem

clients:
  - clientId: grafana
    name: Grafana
    rootUrl: https://monitoring.dev.openveda.cloud
    secret: $(env:GRAFANA_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    redirectUris:
      - https://monitoring.dev.openveda.cloud/*
    webOrigins:
      - https://monitoring.dev.openveda.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - basic
      - email
    protocolMappers:
      # We ensure that user's client roles are injected into the userinfo so that Grafana
      # can retrieve them via the `role_attribute_path` JMES expression.
      - name: client-roles-claim
        protocol: openid-connect
        protocolMapper: oidc-usermodel-client-role-mapper
        config:
          access.token.claim: "false"
          lightweight.claim: "false"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"

          claim.name: roles
          jsonType.label: String
          multivalued: "true"
          usermodel.clientRoleMapping.clientId: grafana # Filter-out non-Grafana roles
          usermodel.clientRoleMapping.rolePrefix: ""

  - clientId: stac
    name: STAC Catalog
    rootUrl: https://dev.openveda.cloud
    publicClient: true
    attributes: {}
    redirectUris:
      - https://dev.openveda.cloud/*
      - https://sit.openveda.cloud/*
      - https://staging.openveda.cloud/*
    webOrigins:
      - https://dev.openveda.cloud
      - https://sit.openveda.cloud
      - https://staging.openveda.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - basic
      - email
      - stac:item:create
      - stac:item:update
      - stac:item:delete
      - stac:collection:create
      - stac:collection:update
      - stac:collection:delete
    protocolMappers:
      # Include user groups in JWT tokens with full paths
      - name: groups
        protocol: openid-connect
        protocolMapper: oidc-group-membership-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: groups
          jsonType.label: String
          multivalued: "true"
          full.path: "true"
      - name: stac_roles
        protocol: openid-connect
        protocolMapper: oidc-usermodel-client-role-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: stac_roles
          jsonType.label: String
          multivalued: "true"
          usermodel.clientRoleMapping.clientId: stac
          usermodel.clientRoleMapping.rolePrefix: ""
      - name: grafana_roles
        protocol: openid-connect
        protocolMapper: oidc-usermodel-client-role-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: grafana_roles
          jsonType.label: String
          multivalued: "true"
          usermodel.clientRoleMapping.clientId: grafana
          usermodel.clientRoleMapping.rolePrefix: ""
      - name: ingest_roles
        protocol: openid-connect
        protocolMapper: oidc-usermodel-client-role-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: ingest_roles
          jsonType.label: String
          multivalued: "true"
          usermodel.clientRoleMapping.clientId: ingest-api
          usermodel.clientRoleMapping.rolePrefix: ""

  - clientId: airflow-stac-etl
    name: Airflow STAC ETL
    secret: $(env:AIRFLOW_STAC_ETL_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    protocol: openid-connect
    fullScopeAllowed: true
    standardFlowEnabled: false
    implicitFlowEnabled: false
    directAccessGrantsEnabled: false
    serviceAccountsEnabled: true
    optionalClientScopes:
      - stac:item:create
      - stac:item:update
      - stac:item:delete
      - stac:collection:create
      - stac:collection:update
      - stac:collection:delete
    defaultClientScopes:
      - roles

  - clientId: ingest-api
    name: STAC Ingest API
    rootUrl: https://dev.openveda.cloud
    publicClient: true
    attributes: {
      "access.token.lifespan": "3600",
    }
    redirectUris:
      - https://dev.openveda.cloud/*
      - https://sit.openveda.cloud/*
      - https://staging.openveda.cloud/*
    webOrigins:
      - https://dev.openveda.cloud
      - https://sit.openveda.cloud
      - https://staging.openveda.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - basic
      - email
      - stac:item:create
      - stac:item:update
      - stac:item:delete
      - stac:collection:create
      - stac:collection:update
      - stac:collection:delete
    protocolMappers:
      # Include user groups in JWT tokens
      - name: groups
        protocol: openid-connect
        protocolMapper: oidc-group-membership-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: groups
          jsonType.label: String
          multivalued: "true"
          full.path: "false"
          usermodel.clientRoleMapping.clientId: ingest-api
          usermodel.clientRoleMapping.rolePrefix: ""

  - clientId: airflow-ingest-api-etl
    name: Airflow Ingest API ETL
    secret: $(env:AIRFLOW_INGEST_API_ETL_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    protocol: openid-connect
    fullScopeAllowed: true
    standardFlowEnabled: false
    implicitFlowEnabled: false
    directAccessGrantsEnabled: false
    serviceAccountsEnabled: true
    optionalClientScopes:
      - stac:item:create
      - stac:item:update
      - stac:item:delete
      - stac:collection:create
      - stac:collection:update
      - stac:collection:delete
    defaultClientScopes:
      - roles



  - clientId: jupyterhub-disasters
    name: Disasters JupyterHub
    # Staging JupyterHub is at https://staging.hub.disasters.2i2c.cloud
    # Prod JupyterHub is at https://hub.disasters.2i2c.cloud
    rootUrl: https://staging.hub.disasters.2i2c.cloud
    secret: $(env:JUPYTERHUB_DISASTERS_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    redirectUris:
      - https://staging.hub.disasters.2i2c.cloud/hub/oauth_callback/*
    webOrigins:
      - https://staging.hub.disasters.2i2c.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - basic
      - profile
    protocolMappers:
      - name: client-roles-claim
        protocol: openid-connect
        protocolMapper: oidc-usermodel-client-role-mapper
        config:
          access.token.claim: "false"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          claim.name: roles
          jsonType.label: String
          multivalued: "true"
          usermodel.clientRoleMapping.clientId: jupyterhub-disasters
          usermodel.clientRoleMapping.rolePrefix: ""

  - clientId: ingest-ui
    name: Ingest UI
    rootUrl: https://ingest.openveda.cloud
    secret: $(env:INGEST_UI_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    redirectUris:
      - https://ingest.openveda.cloud/*
    webOrigins:
      - https://ingest.openveda.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - basic
      - email
      - dataset:create
      - dataset:update
    protocolMappers:
      # Include user groups in JWT tokens
      - name: groups
        protocol: openid-connect
        protocolMapper: oidc-group-membership-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: groups
          jsonType.label: String
          multivalued: "true"
          full.path: "false"
          usermodel.clientRoleMapping.clientId: ingest-ui
          usermodel.clientRoleMapping.rolePrefix: ""

  - clientId: discourse-forum
    name: Discourse
    rootUrl: https://community.openveda.cloud
    secret: $(env:DISCOURSE_FORUM_CLIENT_SECRET)
    publicClient: false
    attributes: {}
    redirectUris:
      - https://community.openveda.cloud/*
    webOrigins:
      - https://community.openveda.cloud
    protocol: openid-connect
    fullScopeAllowed: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - basic
      - email

  - clientId: airflow-webserver-fab
    name: Airflow Webserver FAB
    rootUrl: http://localhost:8080
    publicClient: false
    attributes:
      realm_client: "false"
      oidc.ciba.grant.enabled: "false"
      backchannel.logout.session.required: "true"
      standard.token.exchange.enabled: "false"
      oauth2.device.authorization.grant.enabled: "false"
      backchannel.logout.revoke.offline.tokens: "false"
    redirectUris:
      - http://sm2a.sit.openveda.cloud/oauth-authorized/keycloak
      - http://sm2a.dev.openveda.cloud/oauth-authorized/keycloak
      - http://sm2a.staging.openveda.cloud/oauth-authorized/keycloak
    webOrigins:
      - https://sm2a.sit.openveda.cloud
      - https://sm2a.dev.openveda.cloud
      - https://sm2a.staging.openveda.cloud
    protocol: openid-connect
    standardFlowEnabled: true
    implicitFlowEnabled: false
    directAccessGrantsEnabled: true
    serviceAccountsEnabled: false
    fullScopeAllowed: true
    frontchannelLogout: true
    defaultClientScopes:
      - web-origins
      - acr
      - profile
      - roles
      - groups
      - basic
      - email
    optionalClientScopes:
      - dataset:update
      - dataset:create

  - clientId: uma-resource-server
    name: Authorization Resource Server
    publicClient: false
    secret: $(env:UMA_RESOURCE_SERVER_CLIENT_SECRET)
    protocol: openid-connect
    standardFlowEnabled: false
    implicitFlowEnabled: false
    directAccessGrantsEnabled: false
    serviceAccountsEnabled: true
    authorizationServicesEnabled: true
    protocolMappers:
      - name: groups
        protocol: openid-connect
        protocolMapper: oidc-group-membership-mapper
        config:
          access.token.claim: "true"
          userinfo.token.claim: "true"
          id.token.claim: "true"
          introspection.token.claim: "true"
          claim.name: groups
          jsonType.label: String
          multivalued: "true"
          full.path: "true"
    authorizationSettings:
      allowRemoteResourceManagement: true
      policyEnforcementMode: ENFORCING
      resources:
        - name: stac:collection:public:*
          type: "stac-collection"
          ownerManagedAccess: false
          uris:
            - "stac:collection:public:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:item:public:*
          type: "stac-item"
          ownerManagedAccess: false
          uris:
            - "stac:item:public:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:collection:faketenant1:*
          type: "stac-collection"
          ownerManagedAccess: false
          uris:
            - "stac:collection:faketenant1:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:item:faketenant1:*
          type: "stac-item"
          ownerManagedAccess: false
          uris:
            - "stac:item:faketenant1:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:collection:faketenant2:*
          type: "stac-collection"
          ownerManagedAccess: false
          uris:
            - "stac:collection:faketenant2:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:item:faketenant2:*
          type: "stac-item"
          ownerManagedAccess: false
          uris:
            - "stac:item:faketenant2:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:collection:faketenant3:*
          type: "stac-collection"
          ownerManagedAccess: false
          uris:
            - "stac:collection:faketenant3:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
        - name: stac:item:faketenant3:*
          type: "stac-item"
          ownerManagedAccess: false
          uris:
            - "stac:item:faketenant3:*"
          scopes:
            - name: "create"
            - name: "update"
            - name: "delete"
            - name: "read"
      policies:
        - name: Fake Tenant 1 Editors
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant1/Editors","extendChildren":false}]'
            groupsClaim: "groups"
        - name: Fake Tenant 1 Admins
          description: Fake Tenant 1 Admins Group Policy
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant1/Admins","extendChildren":false}]'
            groupsClaim: "groups"
        - name: Fake Tenant 2 Editors
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant2/Editors","extendChildren":false}]'
            groupsClaim: ""
        - name: Fake Tenant 2 Admins
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant2/Admins","extendChildren":false}]'
            groupsClaim: ""
        - name: Fake Tenant 3 Editors
          description: Fake Tenant 3 Editors Group Policy
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant3/Editors","extendChildren":false}]'
            groupsClaim: ""
        - name: Fake Tenant 3 Admins
          description: Fake Tenant 3 Admins Group Policy
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Tenants/FakeTenant3/Admins","extendChildren":false}]'
            groupsClaim: ""
        - name: Developers
          description: Developers  Group
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Developers","extendChildren":false}]'
            groupsClaim: ""
        - name: Data Editors
          description: Data Editors
          type: group
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            groups: '[{"path":"/Data Editors","extendChildren":false}]'
            groupsClaim: ""
        # Public Collections Permissions
        - name: Public Collections Permission - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:public:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Public Collections Permission - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:public:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Public Collections Permission - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:public:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 3 Admins","Fake Tenant 2 Admins", "Fake Tenant 1 Admins", "Developers"]'
        # Public Items Permissions
        - name: Public Items Permission - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:public:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Public Items Permission - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:public:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Public Items Permission - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:public:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 3 Admins","Fake Tenant 2 Admins","Fake Tenant 1 Admins","Developers"]'
        # Tenant1 - Collections Permissions
        - name: Tenant1 - Collections - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant1:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 1 Editors","Fake Tenant 1 Admins"]'
        - name: Tenant1 - Collections - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant1:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant1 - Collections - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:collection:faketenant1:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 1 Admins"]'
        # Tenant1 - Items Permissions
        - name: Tenant1 - Items - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant1:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 1 Editors","Fake Tenant 1 Admins"]'
        - name: Tenant1 - Items - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant1:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant1 - Items - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:item:faketenant1:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 1 Admins"]'
        # Tenant2 - Collections Permissions
        - name: Tenant2 - Collections - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant2:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 2 Editors", "Fake Tenant 2 Admins"]'
        - name: Tenant2 - Collections - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant2:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant2 - Collections - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:collection:faketenant2:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 2 Admins"]'
        # Tenant2 - Items Permissions
        - name: Tenant2 - Items - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant2:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 2 Admins","Fake Tenant 2 Editors"]'
        - name: Tenant2 - Items -  Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant2:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant2 - Items - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:item:faketenant1:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 2 Admins"]'
        # Tenant3 - Collections Permissions
        - name: Tenant3 - Collections - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant3:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 3 Admins","Fake Tenant 3 Editors"]'
        - name: Tenant3 - Collections - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:collection:faketenant3:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant3 - Collections - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:collection:faketenant3:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 3 Admins"]'
        # Tenant3 - Items Permissions
        - name: Tenant3 - Items - Create, Update
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant3:*"]'
            scopes: '["create","update"]'
            applyPolicies: '["Fake Tenant 3 Admins","Fake Tenant 3 Editors"]'
        - name: Tenant3 - Items - Read
          type: scope
          logic: POSITIVE
          decisionStrategy: AFFIRMATIVE
          config:
            resources: '["stac:item:faketenant3:*"]'
            scopes: '["read"]'
            applyPolicies: '["Fake Tenant 3 Admins", "Fake Tenant 3 Editors", "Fake Tenant 2 Admins", "Fake Tenant 2 Editors", "Fake Tenant 1 Admins", "Fake Tenant 1 Editors", "Data Editors", "Developers"]'
        - name: Tenant3 - Items - Delete
          type: scope
          logic: POSITIVE
          decisionStrategy: UNANIMOUS
          config:
            resources: '["stac:item:faketenant3:*"]'
            scopes: '["delete"]'
            applyPolicies: '["Fake Tenant 3 Admins"]'
      scopes:
        - name: create
        - name: update
        - name: delete
        - name: read
      decisionStrategy: UNANIMOUS

  # FIXME: Update URLs when available
  - clientId: earth-gov-cms
    name: Earth.gov CMS
    rootUrl: http://localhost:3000
    publicClient: false
    secret: $(env:EARTH_GOV_CMS_CLIENT_SECRET)
    attributes: {}
    redirectUris:
      - http://localhost:3000/api/auth/callback/keycloak
    webOrigins:
      - http://localhost:3000
    protocol: openid-connect
    fullScopeAllowed: true
    standardFlowEnabled: true
    implicitFlowEnabled: false
    directAccessGrantsEnabled: false
    serviceAccountsEnabled: false
    protocolMappers:
      - name: groups
        protocol: openid-connect
        protocolMapper: oidc-group-membership-mapper
        config:
          full.path: "false"
          introspection.token.claim: "true"
          userinfo.token.claim: "true"
          multivalued: "true"
          id.token.claim: "true"
          lightweight.claim: "false"
          access.token.claim: "true"
    defaultClientScopes:
      - acr
      - basic
      - email
      - groups
      - profile
      - roles
      - web-origins

roles:
  client:
    grafana:
      - name: GrafanaAdmin
        description: Has full instance-wide permissions to manage all organizations, users, and global settings.
      - name: Admin
        description: Manages an organization's settings, users, dashboards, and data sources within that specific organization.
      - name: Editor
        description: Can create, edit, and delete dashboards and data sources in an organization but cannot modify organization or user settings.
      - name: Viewer
        description: Can only view dashboards and panels without the ability to create or modify content.
      - name: No Basic Role
        description: Has no permissions
    stac:
      - name: Admin
        description: Can create, update and delete STAC collections and items
      - name: Editor
        description: Can create and update STAC collections and items
      - name: Viewer
        description: Can only view STAC collections and items
    ingest-api:
      - name: Admin
        description: Can create, update and delete STAC collections and items
      - name: Editor
        description: Can create and update STAC collections and items
      - name: No Basic Role
        description: Has no permissions
    jupyterhub-disasters:
      - name: Admin
        description: Can use the JupyterHub Admin Panel
      - name: CPU:XS
        description: Access to extra small instances (~1.9GB RAM)
      - name: CPU:S
        description: Access to small instances (~3.7GB RAM)
      - name: CPU:M
        description: Access to medium instances (~7.4GB RAM)
      - name: CPU:L
        description: Access to large instances (~14.8GB RAM)
      - name: CPU:XL
        description: Access to extra large instances (~29.7GB RAM)
      - name: CPU:XXL
        description: Access to extra extra large instances (~60.6GB RAM)
      - name: CPU:XXXL
        description: Access to extra extra extra large instances (~121GB RAM)
      - name: GPU:T4
        description: Access to T4 GPU instances (1 T4 GPU)
    ingest-ui:
      - name: Editor
        description: Can initiate and update dataset ingests
    earth-gov-cms:
      - name: earth-gov-cms-editors
        description: Allow editing content for earth.gov via CMS
    airflow-webserver-fab:
      - name: Admin
        description: Has all possible permissions, including granting or revoking permissions from other users
      - name: Public
        description: No permissions
      - name: Dag_Launcher
        description: Programmatic DAG runs

clientScopeMappings:
  stac:
    - clientScope: stac:item:create
      roles:
        - Admin
        - Editor
    - clientScope: stac:item:update
      roles:
        - Admin
        - Editor
    - clientScope: stac:item:delete
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:create
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:update
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:delete
      roles:
        - Admin
  ingest-api:
    - clientScope: stac:item:create
      roles:
        - Admin
        - Editor
    - clientScope: stac:item:update
      roles:
        - Admin
        - Editor
    - clientScope: stac:item:delete
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:create
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:update
      roles:
        - Admin
        - Editor
    - clientScope: stac:collection:delete
      roles:
        - Admin
  ingest-ui:
    - clientScope: dataset:create
      roles:
        - Editor
    - clientScope: dataset:update
      roles:
        - Editor

clientScopes:
  - name: stac:item:create
    description: Create STAC items
    protocol: openid-connect
  - name: stac:item:update
    description: Update STAC items
    protocol: openid-connect
  - name: stac:item:delete
    description: Delete STAC items
    protocol: openid-connect
  - name: stac:collection:create
    description: Create STAC collections
    protocol: openid-connect
  - name: stac:collection:update
    description: Update STAC collections
    protocol: openid-connect
  - name: stac:collection:delete
    description: Delete STAC collections
    protocol: openid-connect
  - name: dataset:create
    description: Ingest new datasets
    protocol: openid-connect
  - name: dataset:update
    description: Update existing datasets
    protocol: openid-connect

groups:
  - name: System Administrators
    clientRoles:
      grafana:
        - GrafanaAdmin
      stac:
        - Admin
      ingest-api:
        - Admin
      ingest-ui:
        - Editor
      airflow-webserver-fab:
        - Admin

  - name: Developers
    clientRoles:
      grafana:
        - Editor
      stac:
        - Admin
      ingest-api:
        - Admin
      ingest-ui:
        - Editor
      airflow-webserver-fab:
        - Admin

  - name: Data Editors
    clientRoles:
      grafana:
        - Viewer
      stac:
        - Editor
      ingest-api:
        - Editor
      ingest-ui:
        - Editor

  - name: No Basic Role
    clientRoles:
      grafana:
        - No Basic Role
      stac:
        - Viewer
      ingest-api:
        - No Basic Role
      airflow-webserver-fab:
        - Public

  - name: JupyterHub Disasters Admin
    clientRoles:
      jupyterhub-disasters:
        - Admin

  - name: JupyterHub Disasters User
    clientRoles:
      jupyterhub-disasters:
        - CPU:XS
        - CPU:S
        - CPU:M
        - CPU:L
        - CPU:XL
        - CPU:XXL
        - CPU:XXL
        - CPU:XXXL

  - name: JupyterHub Disasters GPU User
    clientRoles:
      jupyterhub-disasters:
        - GPU:T4

  - name: Tenants
    subGroups:
      - name: FakeTenant1
        subGroups:
          - name: Admins
            clientRoles:
              grafana:
                - GrafanaAdmin
              stac:
                - Admin
              ingest-api:
                - Admin
          - name: Editors
            clientRoles:
              grafana:
                - Editor
              stac:
                - Editor
              ingest-api:
                - Editor
              ingest-ui:
                - Editor

      - name: FakeTenant2
        subGroups:
          - name: Admins
            clientRoles:
              grafana:
                - GrafanaAdmin
              stac:
                - Admin
              ingest-api:
                - Admin
          - name: Editors
            clientRoles:
              grafana:
                - Editor
              stac:
                - Editor
              ingest-api:
                - Editor
              ingest-ui:
                - Editor

      - name: FakeTenant3
        subGroups:
          - name: Admins
            clientRoles:
              grafana:
                - GrafanaAdmin
              stac:
                - Admin
              ingest-api:
                - Admin
          - name: Editors
            clientRoles:
              grafana:
                - Editor
              stac:
                - Editor
              ingest-api:
                - Editor
              ingest-ui:
                - Editor

  - name: Earth.gov CMS Editors
    clientRoles:
      earth-gov-cms:
        - earth-gov-cms-editors

identityProviders:
  # CILogon
  - alias: cilogon # NOTE: this alias appears in the redirect_uri for the auth flow, update Github OAuth settings accordingly
    displayName: CILogon
    providerId: oidc
    enabled: true
    updateProfileFirstLoginMode: on
    trustEmail: false
    storeToken: false
    addReadTokenRoleOnCreate: false
    authenticateByDefault: false
    linkOnly: false
    config:
      userInfoUrl: "https://cilogon.org/oauth2/userinfo"
      validateSignature: "true"
      tokenUrl: "https://cilogon.org/oauth2/token"
      jwksUrl: "https://cilogon.org/oauth2/certs"
      issuer: "https://cilogon.org"
      useJwksUrl: "true"
      pkceEnabled: "false"
      defaultScope: "openid email profile"
      metadataDescriptorUrl: "https://cilogon.org/.well-known/openid-configuration"
      authorizationUrl: "https://cilogon.org/authorize"
      clientAuthMethod: "client_secret_post"
      syncMode: "IMPORT"
      clientId: $(env:CILOGON_CLIENT_ID)
      clientSecret: $(env:CILOGON_CLIENT_SECRET)
identityProviderMappers:
  - name: "email"
    identityProviderAlias: cilogon
    identityProviderMapper: oidc-user-attribute-idp-mapper
    config:
      syncMode: "IMPORT"
      claim: "email"
      user.attribute: "email"
  - name: "first name"
    identityProviderAlias: cilogon
    identityProviderMapper: oidc-user-attribute-idp-mapper
    config:
      syncMode: "IMPORT"
      claim: "profile.given_name"
      user.attribute: "firstName"
  - name: "last name"
    identityProviderAlias: cilogon
    identityProviderMapper: oidc-user-attribute-idp-mapper
    config:
      syncMode: "IMPORT"
      claim: "profile.family_name"
      user.attribute: "lastName"

authenticatorConfig:
  - alias: cilogon
    config:
      defaultProvider: cilogon

users:
  - username: service-account-airflow-webserver-fab
    emailVerified: true
    enabled: true
    serviceAccountClientId: airflow-webserver-fab
    clientRoles:
      airflow-webserver-fab:
      - Dag_Launcher
  - username: service-account-airflow-stac-etl
    emailVerified: true
    enabled: true
    serviceAccountClientId: airflow-stac-etl
    clientRoles:
      stac:
      - Admin
  - username: service-account-airflow-ingest-api-etl
    emailVerified: true
    enabled: true
    serviceAccountClientId: airflow-ingest-api-etl
    clientRoles:
      ingest-api:
      - Admin

eventsListeners:
  - jboss-logging
  - email-on-user-creation

defaultGroups:
  - "/No Basic Role"

